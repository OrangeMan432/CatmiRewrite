# Các bước thực hiện trong công việc
steps:
  # 1. Checkout mã nguồn
  - name: Checkout repository
    uses: actions/checkout@v4
    
  # 2. Thiết lập môi trường Java 8 (BẮT BUỘC cho 1.12.2)
  - name: Set up Java 8
    uses: actions/setup-java@v4
    with:
      distribution: 'temurin'
      java-version: '8'
      cache: 'gradle'

  # 3. Cấp quyền thực thi cho gradlew
  - name: Grant execute permission for gradlew
    run: chmod +x gradlew
    
  # 4. CHẠY LẠI SETUP (Forge/Gradle cũ thường cần bước này)
  # Bước này đảm bảo tất cả các file cần thiết (như các dependency của Minecraft) được tải về trước khi build.
  - name: Pre-setup Minecraft environment
    run: ./gradlew setupDecompWorkspace --refresh-dependencies
  
  # 5. Chạy lệnh build chính thức
  # 'reobfJar' là task để tạo ra file mod .jar cuối cùng
  - name: Build with Gradle
    # Sử dụng '--stacktrace' để nếu build thất bại, chúng ta có thể thấy lỗi chi tiết hơn
    run: ./gradlew build reobfJar --stacktrace
    
  # 6. Tải lên Artifact
  - name: Upload Mod Artifact
    uses: actions/upload-artifact@v4
    with:
      name: CatmiRewrite-1.12.2-mod
      path: build/libs/*.jar
      if-no-files-found: error
      retention-days: 7
